<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Insurance Fraud Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --dark-bg: #1e293b;
            --light-bg: #f8fafc;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header-card h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header-card .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .form-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        
        .section-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            margin-top: 30px;
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        
        .section-header i {
            font-size: 1.4rem;
        }
        
        .form-label {
            font-weight: 600;
            color: #334155;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .form-control, .form-select {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px 15px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.15);
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: none;
            padding: 18px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 15px;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
            margin-top: 30px;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(239, 68, 68, 0.5);
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        .submit-btn:active {
            transform: translateY(-1px);
        }
        
        .result {
            margin-top: 30px;
            padding: 30px;
            border-radius: 15px;
            display: none;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result h4 {
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .result .h5 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .risk-meter {
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
        }
        
        .risk-meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);
            border-radius: 15px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: 700;
        }
        
        .col-md-6 {
            margin-bottom: 20px;
        }
        
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
        
        .badge {
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header-card">
            <h1><i class="fas fa-shield-alt"></i> Professional Insurance Fraud Detection</h1>
            <p class="subtitle">Advanced AI-Powered Risk Assessment System</p>
        </div>

        <div class="form-container">
            <form id="fraudForm">
                <!-- Driver Profile Section -->
                <h4 class="section-header">
                    <i class="fas fa-user-tie"></i> Driver Profile
                </h4>
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="age_of_driver" class="form-label">Age Of Driver:</label>
                    <input type="number" class="form-control" id="age_of_driver" required min="18" max="100" value="24">
                </div>
                <div class="col-md-6">
                    <label for="gender" class="form-label">Gender:</label>
                    <select class="form-select" id="gender" required>
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="marital_status" class="form-label">Marital Status:</label>
                    <select class="form-select" id="marital_status" required>
                        <option value="1.0">Single</option>
                        <option value="2.0">Married</option>
                        <option value="3.0">Divorced</option>
                        <option value="4.0">Widowed</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="annual_income" class="form-label">Annual Income:</label>
                    <input type="number" class="form-control" id="annual_income" required min="0" value="47305">
                </div>
                <div class="col-md-6">
                    <label for="high_education_ind" class="form-label">High Education Ind:</label>
                    <select class="form-select" id="high_education_ind" required>
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="address_change_ind" class="form-label">Address Change Ind:</label>
                    <select class="form-select" id="address_change_ind" required>
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="living_status" class="form-label">Living Status:</label>
                    <select class="form-select" id="living_status" required>
                        <option value="Rent">Rent</option>
                        <option value="Own">Own</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>

            <!-- Vehicle Details Section -->
            <h4 class="section-header">
                <i class="fas fa-car"></i> Vehicle Details
            </h4>
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="age_of_vehicle" class="form-label">Age Of Vehicle:</label>
                    <input type="number" class="form-control" id="age_of_vehicle" required min="0" max="50" value="10">
                </div>
                <div class="col-md-6">
                    <label for="vehicle_price" class="form-label">Vehicle Price:</label>
                    <input type="number" class="form-control" id="vehicle_price" required min="0" value="1768">
                </div>
                <div class="col-md-6">
                    <label for="vehicle_weight" class="form-label">Vehicle Weight:</label>
                    <input type="number" class="form-control" id="vehicle_weight" required min="0" value="2524">
                </div>
                <div class="col-md-6">
                    <label for="vehicle_category" class="form-label">Vehicle Category:</label>
                    <select class="form-select" id="vehicle_category" required>
                        <option value="Sedan">Sedan</option>
                        <option value="SUV">SUV</option>
                        <option value="Truck">Truck</option>
                        <option value="Van">Van</option>
                        <option value="Sports">Sports</option>
                        <option value="Luxury">Luxury</option>
                        <option value="Compact">Compact</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="vehicle_color" class="form-label">Vehicle Color:</label>
                    <select class="form-select" id="vehicle_color" required>
                        <option value="Black">Black</option>
                        <option value="White">White</option>
                        <option value="Red">Red</option>
                        <option value="Blue">Blue</option>
                        <option value="Silver">Silver</option>
                        <option value="Gray">Gray</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="safty_rating" class="form-label">Safety Rating:</label>
                    <input type="number" class="form-control" id="safty_rating" required min="0" max="100" value="0">
                </div>
            </div>

            <!-- Claim Information Section -->
            <h4 class="section-header">
                <i class="fas fa-file-invoice-dollar"></i> Claim Information
            </h4>
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="past_num_of_claims" class="form-label">Past Num Of Claims:</label>
                    <input type="number" class="form-control" id="past_num_of_claims" required min="0" value="6">
                </div>
                <div class="col-md-6">
                    <label for="claim_est_payout" class="form-label">Claim Est Payout:</label>
                    <input type="number" class="form-control" id="claim_est_payout" required min="0" value="11703">
                </div>
                <div class="col-md-6">
                    <label for="claim_day_of_week" class="form-label">Claim Day Of Week:</label>
                    <select class="form-select" id="claim_day_of_week" required>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                        <option value="Sunday">Sunday</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="accident_site" class="form-label">Accident Site:</label>
                    <select class="form-select" id="accident_site" required>
                        <option value="Highway">Highway</option>
                        <option value="Parking">Parking</option>
                        <option value="Local">Local</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="witness_present_ind" class="form-label">Witness Present Ind:</label>
                    <select class="form-select" id="witness_present_ind" required>
                        <option value="0.0">No</option>
                        <option value="1.0">Yes</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="policy_report_filed_ind" class="form-label">Policy Report Filed Ind:</label>
                    <select class="form-select" id="policy_report_filed_ind" required>
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="channel" class="form-label">Channel:</label>
                    <select class="form-select" id="channel" required>
                        <option value="Phone">Phone</option>
                        <option value="Web">Web</option>
                        <option value="Agent">Agent</option>
                        <option value="Mail">Mail</option>
                        <option value="Broker">Broker</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="liab_prct" class="form-label">Liab Prct:</label>
                    <select class="form-select" id="liab_prct" required>
                        <option value="0-20">0-20%</option>
                        <option value="20-50">20-50%</option>
                        <option value="50-70">50-70%</option>
                        <option value="70-100">70-100%</option>
                    </select>
                </div>
            </div>

                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn submit-btn">
                        <i class="fas fa-search"></i> Analyze Fraud Risk
                    </button>
                </div>
            </form>

            <div id="result" class="result">
                <h4><i class="fas fa-chart-line"></i> Risk Assessment Result</h4>
                <div id="predictionText" class="h5"></div>
                <div class="risk-meter">
                    <div id="riskMeterFill" class="risk-meter-fill" style="width: 0%">
                        <span id="riskPercentage">0%</span>
                    </div>
                </div>
                <div id="confidence" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script>
        // API endpoint - update this if your backend is running on a different URL
        const API_URL = 'http://localhost:8000';
        
        document.getElementById('fraudForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Analyzing...';
            
            // Get form values - match exact training data format
            const formData = {
                age_of_driver: parseInt(document.getElementById('age_of_driver').value),
                safty_rating: parseInt(document.getElementById('safty_rating').value),
                annual_income: parseInt(document.getElementById('annual_income').value),
                vehicle_price: parseInt(document.getElementById('vehicle_price').value),
                age_of_vehicle: parseInt(document.getElementById('age_of_vehicle').value),
                past_num_of_claims: parseInt(document.getElementById('past_num_of_claims').value),
                claim_est_payout: parseInt(document.getElementById('claim_est_payout').value),
                vehicle_weight: parseInt(document.getElementById('vehicle_weight').value),
                marital_status: document.getElementById('marital_status').value,  // String
                high_education_ind: document.getElementById('high_education_ind').value,  // String
                address_change_ind: document.getElementById('address_change_ind').value,  // String
                witness_present_ind: document.getElementById('witness_present_ind').value,  // String
                liab_prct: document.getElementById('liab_prct').value,
                policy_report_filed_ind: document.getElementById('policy_report_filed_ind').value,  // String
                gender: document.getElementById('gender').value,
                living_status: document.getElementById('living_status').value,
                claim_day_of_week: document.getElementById('claim_day_of_week').value,
                accident_site: document.getElementById('accident_site').value,
                channel: document.getElementById('channel').value,
                vehicle_category: document.getElementById('vehicle_category').value,
                vehicle_color: document.getElementById('vehicle_color').value
            };
            
            console.log('Sending data:', formData);

            try {
                // Send request to the backend
                const response = await fetch(`${API_URL}/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    if (response.status === 422) {
                        // Validation error - get detailed error info
                        const errorData = await response.json();
                        console.error('Validation error:', errorData);
                        let errorDetails = [];
                        if (errorData.detail) {
                            if (Array.isArray(errorData.detail)) {
                                errorData.detail.forEach(err => {
                                    errorDetails.push(`${err.loc.join('.')}: ${err.msg}`);
                                });
                            } else {
                                errorDetails.push(errorData.detail);
                            }
                        }
                        throw new Error('Validation error: ' + errorDetails.join(', '));
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.detail || 'Failed to get prediction');
                    }
                }
                
                const result = await response.json();
                
                // Display result with animation
                const resultDiv = document.getElementById('result');
                const predictionText = document.getElementById('predictionText');
                const confidenceText = document.getElementById('confidence');
                const riskMeterFill = document.getElementById('riskMeterFill');
                const riskPercentage = document.getElementById('riskPercentage');
                
                const confidencePercent = (result.confidence * 100).toFixed(1);
                
                // Determine risk level and styling
                let riskLevel, riskIcon, riskClass, recommendation;
                if (result.is_fraud) {
                    if (confidencePercent >= 90) {
                        riskLevel = "EXTREME RISK";
                        riskIcon = "üö®";
                        riskClass = "alert alert-danger";
                        recommendation = "Immediate investigation required. High confidence fraud detected.";
                    } else if (confidencePercent >= 75) {
                        riskLevel = "HIGH RISK";
                        riskIcon = "‚ö†Ô∏è";
                        riskClass = "alert alert-danger";
                        recommendation = "Priority review recommended. Strong fraud indicators present.";
                    } else {
                        riskLevel = "ELEVATED RISK";
                        riskIcon = "‚ö†Ô∏è";
                        riskClass = "alert alert-warning";
                        recommendation = "Detailed review suggested. Multiple risk factors detected.";
                    }
                } else {
                    if (confidencePercent >= 90) {
                        riskLevel = "VERY LOW RISK";
                        riskIcon = "‚úÖ";
                        riskClass = "alert alert-success";
                        recommendation = "Transaction appears legitimate. Fast-track processing approved.";
                    } else if (confidencePercent >= 75) {
                        riskLevel = "LOW RISK";
                        riskIcon = "‚úÖ";
                        riskClass = "alert alert-success";
                        recommendation = "Minimal concerns detected. Standard processing recommended.";
                    } else {
                        riskLevel = "MODERATE RISK";
                        riskIcon = "‚ÑπÔ∏è";
                        riskClass = "alert alert-info";
                        recommendation = "Standard review process advised.";
                    }
                }
                
                resultDiv.className = 'result ' + riskClass;
                predictionText.innerHTML = `${riskIcon} <strong>${riskLevel}</strong><br><small>${result.message}</small>`;
                
                // Animate risk meter
                setTimeout(() => {
                    riskMeterFill.style.width = confidencePercent + '%';
                    riskPercentage.textContent = confidencePercent + '%';
                }, 100);
                
                confidenceText.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Confidence Level:</strong> 
                            <span class="badge bg-primary">${confidencePercent}%</span>
                        </div>
                        <div class="text-end">
                            <small class="text-muted">${recommendation}</small>
                        </div>
                    </div>
                `;
                
                resultDiv.style.display = 'block';
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
            } catch (error) {
                console.error('Error:', error);
                const resultDiv = document.getElementById('result');
                resultDiv.className = 'result alert alert-warning';
                
                // Try to get more detailed error information
                let errorMessage = 'Failed to process request';
                if (error.message) {
                    errorMessage = error.message;
                } else if (error.detail) {
                    errorMessage = error.detail;
                } else if (typeof error === 'object') {
                    errorMessage = JSON.stringify(error);
                }
                
                document.getElementById('predictionText').textContent = 'Error: ' + errorMessage;
                document.getElementById('confidence').textContent = '';
                resultDiv.style.display = 'block';
            } finally {
                // Reset button
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        });
    </script>
</body>
</html>